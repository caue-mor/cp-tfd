<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Fidelidade</title>
    <link rel="stylesheet" href="/static/css/fidelidade.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <div class="logo">üîç</div>
                <h1>Teste de Fidelidade</h1>
                <p class="subtitle">Descubra a verdade. R$29,90</p>
            </div>

            <!-- Toggle tabs -->
            <div class="auth-tabs">
                <button class="tab-btn active" data-tab="register">Criar Conta</button>
                <button class="tab-btn" data-tab="login">Entrar</button>
            </div>

            <!-- Register form -->
            <form id="register-form" class="auth-form">
                <div class="form-group">
                    <label for="reg-nome">Nome</label>
                    <input type="text" id="reg-nome" placeholder="Seu nome" required>
                </div>
                <div class="form-group">
                    <label for="reg-email">Email</label>
                    <input type="email" id="reg-email" placeholder="seu@email.com" required>
                </div>
                <div class="form-group">
                    <label for="reg-telefone">Telefone</label>
                    <input type="tel" id="reg-telefone" placeholder="(11) 99999-9999" required>
                </div>
                <div class="form-group">
                    <label for="reg-senha">Senha</label>
                    <input type="password" id="reg-senha" placeholder="Minimo 6 caracteres" required minlength="6">
                </div>
                <button type="submit" class="btn btn-primary" id="register-btn">Criar Conta</button>
            </form>

            <!-- Login form -->
            <form id="login-form" class="auth-form" style="display:none">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" placeholder="seu@email.com" required>
                </div>
                <div class="form-group">
                    <label for="login-senha">Senha</label>
                    <input type="password" id="login-senha" placeholder="Sua senha" required>
                </div>
                <button type="submit" class="btn btn-primary" id="login-btn">Entrar</button>
            </form>

            <div id="auth-error" class="error-msg" style="display:none"></div>
        </div>
    </div>

    <script>
        // Check if already logged in
        const token = localStorage.getItem('fidelidade_token');
        if (token) {
            window.location.href = '/fidelidade/painel';
        }

        // Tab toggle
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const tab = btn.dataset.tab;
                document.getElementById('register-form').style.display = tab === 'register' ? 'block' : 'none';
                document.getElementById('login-form').style.display = tab === 'login' ? 'block' : 'none';
                document.getElementById('auth-error').style.display = 'none';
            });
        });

        function showError(msg) {
            const el = document.getElementById('auth-error');
            el.textContent = msg;
            el.style.display = 'block';
        }

        // Register
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('register-btn');
            btn.disabled = true;
            btn.textContent = 'Criando...';

            try {
                const res = await fetch('/api/fidelidade/register', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        nome: document.getElementById('reg-nome').value,
                        email: document.getElementById('reg-email').value,
                        telefone: document.getElementById('reg-telefone').value,
                        senha: document.getElementById('reg-senha').value,
                    })
                });
                const data = await res.json();
                if (data.success) {
                    localStorage.setItem('fidelidade_token', data.token);
                    window.location.href = '/fidelidade/painel';
                } else {
                    showError(data.error || 'Erro ao criar conta');
                }
            } catch (err) {
                showError('Erro de conexao');
            }

            btn.disabled = false;
            btn.textContent = 'Criar Conta';
        });

        // Login
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('login-btn');
            btn.disabled = true;
            btn.textContent = 'Entrando...';

            try {
                const res = await fetch('/api/fidelidade/login', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        email: document.getElementById('login-email').value,
                        senha: document.getElementById('login-senha').value,
                    })
                });
                const data = await res.json();
                if (data.success) {
                    localStorage.setItem('fidelidade_token', data.token);
                    window.location.href = '/fidelidade/painel';
                } else {
                    showError(data.error || 'Email ou senha incorretos');
                }
            } catch (err) {
                showError('Erro de conexao');
            }

            btn.disabled = false;
            btn.textContent = 'Entrar';
        });
    </script>
</body>
</html>
